#!/bin/bash

# Output CSV file
output_file="pokemon_report.csv"

# CSV Header
echo "Name,Height (m),Weight (kg)" > "$output_file"

# Loop through all JSON files in pokemon_data
for file in pokemon_data/*.json; do
    name=$(jq -r '.name' "$file" | sed 's/.*/\u&/') # Capitalize first letter
    height=$(jq -r '.height' "$file")
    weight=$(jq -r '.weight' "$file")

    # Convert height from decimetres to metres, weight from hectograms to kilograms
    height_m=$(awk "BEGIN {print $height / 10}")
    weight_kg=$(awk "BEGIN {print $weight / 10}")

    echo "$name,$height_m,$weight_kg" >> "$output_file"
done

echo
echo "CSV Report generated at: $output_file"
echo

# Display CSV content
cat "$output_file"
echo

# Calculate averages
avg_height=$(awk -F',' 'NR>1 {sum+=$2} END {if (NR>1) print sum/(NR-1)}' "$output_file")
avg_weight=$(awk -F',' 'NR>1 {sum+=$3} END {if (NR>1) print sum/(NR-1)}' "$output_file")

echo "Average Height: $(printf "%.2f" "$avg_height") m"
echo "Average Weight: $(printf "%.2f" "$avg_weight") kg"
